<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>自动生成评论系统</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="./lib/element-ui/index.css">
    <link rel="stylesheet" href="./css/phone.css">
    <link rel="stylesheet" href="./css/style.css">
</head>

<body>
    <div id="app" class="hide">
        <el-form ref="form" label-width="80px" :model="formData" size="small" @submit.native.prevent>
            <el-card header="基础信息">
                <el-row>
                    <el-col v-bind="colBindAttribute">
                        <el-form-item label="主题色" required>
                            <el-radio-group v-model="formData.themeIsDefault">
                                <el-radio :label="true">浅色</el-radio>
                                <el-radio :label="false">深色</el-radio>
                            </el-radio-group>
                        </el-form-item>
                        <el-form-item label="上传图片" prop="files" ref="files-item" :rules="requiredRule('上传图片')">
                            <c-upload v-model="formData.files" list-type="picture" :accept="fileAccept" v-bind="$attrs" v-on="$listeners" @change="uploadClearVali('files-item')"
                            />
                        </el-form-item>
                        <el-form-item label="评论顶部" required>
                            <el-radio-group v-model="formData.commentTop">
                                <el-radio :label="1">显示位置+看过人次</el-radio>
                                <el-radio :label="2">显示大家都在搜</el-radio>
                            </el-radio-group>
                        </el-form-item>
                        <template v-if="formData.commentTop === 1">
                            <el-form-item label="地区" prop="areaCH" :rules="requiredRule('请输入地区')">
                                <el-input v-model="formData.areaCH" placeholder="请输入地区"></el-input>
                            </el-form-item>
                            <el-form-item label="看过人次" prop="numberOfSeen" :rules="requiredRule('请输入人次')">
                                <el-input type="number" v-model="formData.numberOfSeen" placeholder="请输入人次" class="input-with-select">
                                    <el-select v-model="formData.numberOfSeenUnit" slot="append" placeholder="请选择">
                                        <el-option label="无单位" value=""></el-option>
                                        <el-option label="万" value="万"></el-option>
                                        <el-option label="亿" value="亿"></el-option>
                                    </el-select>
                                </el-input>
                            </el-form-item>
                        </template>
                        <el-form-item label="都在搜" prop="searchWord" :rules="requiredRule('请输入显示的大家都在搜内容')" v-else-if="formData.commentTop === 2">
                            <el-input v-model="formData.searchWord" maxlength="12" placeholder="请输入显示的大家都在搜内容"></el-input>
                        </el-form-item>
                        <el-form-item label="总评论数" prop="commentNum" :rules="requiredRule('请输入评论数')">
                            <el-input type="number" v-model="formData.commentNum" placeholder="请输入评论数"></el-input>
                        </el-form-item>
                    </el-col>
                </el-row>
            </el-card>
            <el-card header="" v-for="(item, key) in formData.commentList" :key="key">
                <div slot="header" class="clearfix">
                    <span>一级评论</span>
                    <el-button class="text-btn-del" type="text" v-if="formData.commentList.length > 1" @click="delComment({key:key})">删除
                        <i class="el-icon-delete"></i>
                    </el-button>
                </div>
                <el-row>
                    <el-col v-bind="colBindAttribute">
                        <el-form-item label="上传图片" :ref="`form-upload-${key}`" :prop="`commentList[${key}].files`" :rules="requiredRule('请上传头像')">
                            <c-upload v-model="item.files" list-type="picture-card" :accept="fileAccept" @change="uploadClearVali(`form-upload-${key}`)"
                            />
                        </el-form-item>
                        <el-form-item label="地区" :prop="`commentList[${key}].areaCH`" :rules="requiredRule('请输入地区')">
                            <el-input v-model="item.areaCH" maxlength="3" placeholder="请输入地区"></el-input>
                        </el-form-item>
                        <el-form-item label="昵称" :prop="`commentList[${key}].name`" :rules="requiredRule('请输入昵称')">
                            <el-input v-model="item.name" maxlength="20" placeholder="请输入昵称"></el-input>
                        </el-form-item>
                        <el-form-item label="时间" :prop="`commentList[${key}].time`" :rules="requiredRule('请输入评论时间')">
                            <el-input v-model="item.time" placeholder="请输入评论时间"></el-input>
                            </el-date-picker>
                        </el-form-item>
                        <el-form-item label="内容" :prop="`commentList[${key}].content`" :rules="requiredRule('请输入评论内容')">
                            <el-input type="textarea" v-model="item.content" placeholder="请输入评论内容" :autosize="{ minRows: 2, maxRows: 4}"></el-input>
                        </el-form-item>
                        <el-form-item label="是否作者" required>
                            <el-radio-group v-model="item.isAuthor">
                                <el-radio :label="false">否</el-radio>
                                <el-radio :label="true">是</el-radio>
                            </el-radio-group>
                        </el-form-item>
                        <el-form-item label="是否被赞" required>
                            <el-radio-group v-model="item.isLikes">
                                <el-radio :label="false">否</el-radio>
                                <el-radio :label="true">是</el-radio>
                            </el-radio-group>
                        </el-form-item>
                        <el-form-item label="点赞数" :prop="`commentList[${key}].likesNum`" :rules="requiredRule('请输入点赞数')">
                            <el-input type="number" v-model="item.likesNum" placeholder="请输入点赞数"></el-input>
                        </el-form-item>
                        <el-form-item label="点踩数" :prop="`commentList[${key}].noLikesNum`" :rules="requiredRule('请输入点踩数')">
                            <el-input type="number" v-model="item.noLikesNum" placeholder="请输入点踩数"></el-input>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col v-bind="col2BindAttribute" :push="2">
                        <el-card v-for="(iitem, kkey) in item.child" :key="`${key}${kkey}`">
                            <div slot="header" class="clearfix">
                                <span>二级评论</span>
                                <el-button class="text-btn-del" type="text" @click="delComment({key:key, kkey:kkey})">删除
                                    <i class="el-icon-delete"></i>
                                </el-button>
                            </div>
                            <el-form-item label="头像" :ref="`form-upload-${key}${kkey}`" :prop="`commentList[${key}].child[${kkey}].files`" :rules="requiredRule('请上传头像')">
                                <c-upload v-model="iitem.files" list-type="picture-card" :accept="fileAccept" @change="uploadClearVali(`form-upload-${key}${kkey}`)"
                                />
                            </el-form-item>
                            <el-form-item label="地区" :prop="`commentList[${key}].child[${kkey}].areaCH`" :rules="requiredRule('请输入地区')">
                                <el-input v-model="iitem.areaCH" maxlength="3" placeholder="请输入地区"></el-input>
                            </el-form-item>
                            <el-form-item label="昵称" :prop="`commentList[${key}].child[${kkey}].name`" :rules="requiredRule('请输入昵称')">
                                <el-input v-model="iitem.name" maxlength="20" placeholder="请输入昵称"></el-input>
                            </el-form-item>
                            <el-form-item label="时间" :prop="`commentList[${key}].child[${kkey}].time`" :rules="requiredRule('请输入评论时间')">
                                <el-input v-model="iitem.time" placeholder="请输入发布时间"></el-input>
                                </el-date-picker>
                            </el-form-item>
                            <el-form-item label="内容" :prop="`commentList[${key}].child[${kkey}].content`" :rules="requiredRule('请输入评论内容')">
                                <el-input type="textarea" v-model="iitem.content" placeholder="请输入评论内容" :autosize="{ minRows: 2, maxRows: 4}"></el-input>
                            </el-form-item>
                            <el-form-item label="被回昵称" v-show="!iitem.isAuthor">
                                <el-input v-model="iitem.replyNickname" maxlength="20" placeholder="请输入被回复用户昵称"></el-input>
                            </el-form-item>
                            <el-form-item label="是否作者" required>
                                <el-radio-group v-model="iitem.isAuthor">
                                    <el-radio :label="false">否</el-radio>
                                    <el-radio :label="true">是</el-radio>
                                </el-radio-group>
                            </el-form-item>
                            <el-form-item label="是否被赞" required>
                                <el-radio-group v-model="iitem.isLikes">
                                    <el-radio :label="false">否</el-radio>
                                    <el-radio :label="true">是</el-radio>
                                </el-radio-group>
                            </el-form-item>
                            <el-form-item label="点赞数" :prop="`commentList[${key}].child[${kkey}].likesNum`" :rules="requiredRule('请输入点赞数')">
                                <el-input type="number" v-model="iitem.likesNum" placeholder="请输入点赞数"></el-input>
                            </el-form-item>
                            <el-form-item label="点踩数" :prop="`commentList[${key}].child[${kkey}].noLikesNum`" :rules="requiredRule('请输入点踩数')">
                                <el-input type="number" v-model="iitem.noLikesNum" placeholder="请输入点踩数"></el-input>
                            </el-form-item>
                        </el-card>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col>
                        <el-form-item class="add-comment-form-item">
                            <el-button type="primary" @click="createComment({key:key})">
                                增加二级评论
                                <i class="el-icon-plus"></i>
                            </el-button>
                        </el-form-item>
                    </el-col>
                </el-row>
            </el-card>
            <el-form-item class="add-comment-form-item">
                <el-button type="primary" @click="createComment()">增加一级评论
                    <i class="el-icon-plus"></i>
                </el-button>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click.prevent="onSubmit">提交</el-button>
            </el-form-item>
        </el-form>

        <c-crateshot ref="c-crateshot" />
    </div>
    <script src="./js/AWE2342da.js"></script>
    <script src="./lib/vue/vue.min.js"></script>
    <!-- 引入组件库 -->
    <script src="./lib/element-ui/index.js"></script>
    <script src="./lib/html2canvas/html2canvas.min.js" async></script>
    <script>
        /*
        代码加密方式：
        
        
        */
        (function () {

            var keyStr = 'ajseqwesz121!5'
            var ivStr = '4566ai0qO23412312'

            function decrypt(data, keyS, ivS) {
                let key = keyS || keyStr
                let iv = ivS || ivStr
                key = CryptoJS.enc.Utf8.parse(key)
                iv = CryptoJS.enc.Utf8.parse(iv)
                return CryptoJS.DES.decrypt(data, key, {
                    iv: iv,
                    mode: CryptoJS.mode.CBC,
                    padding: CryptoJS.pad.Pkcs7,
                }).toString(CryptoJS.enc.Utf8)
            }


            function getTimeSecretKey(paramVal) {
                var valDate = new Date(paramVal)
                var year = valDate.getFullYear()
                var month = valDate.getMonth() + 1
                var day = valDate.getDate()
                var hour = valDate.getHours()
                var minute = valDate.getMinutes()
                var second = valDate.getSeconds()
                var singleNumber = [year, month, day, hour, minute, second].reduce(function (beforeNum, afterNum) {
                    if (afterNum) {
                        if (afterNum > 10) {
                            afterNum = String(afterNum).split('').reduce(function (beforeSonNum,
                                afterSonNum) {
                                beforeSonNum = Number(beforeSonNum)
                                afterSonNum = Number(afterSonNum)
                                return afterSonNum ? beforeSonNum + afterSonNum : beforeSonNum
                            }, 0)
                        }
                        return beforeNum + afterNum
                    } else {
                        return beforeNum
                    }
                }, 0)
                var total = [year, month, day, hour, minute, second].reduce(function (beforeNum, afterNum) {
                    return afterNum ? beforeNum + afterNum : beforeNum
                })
                console.log(total, singleNumber)
                return total + singleNumber
            }

            function getQueryString(name) {
                var query_string = window.location.search;
                if (!query_string) return null; // 如果无参，返回null
                var re = /[?&]?([^=]+)=([^&]*)/g;
                var tokens;
                while (tokens = re.exec(query_string)) {
                    if (decodeURIComponent(tokens[1]) === name) {
                        return decodeURIComponent(tokens[2]);
                    }
                }
                return null;
            }

            (function () {

                // 获取时间第二密钥
                // 年+月+日+时+分+秒=密钥
                /*

                eg: 2345-10-11 02:03:05

                (年+月+日+时+分+秒)+(年月日时分秒拆成单个 个位数字 相加的结果)

                 年     月   日   时  分  秒       拆分的年   月  日     时    分  秒
                (2345  +10  +11  +2  +3  +4) + (  2+3+4+5   +1  +1+1   +2   +3  +4  )
                
                
                */
                function getTimeSecretKey(paramVal) {
                    var valDate = new Date(paramVal)
                    var year = valDate.getFullYear()
                    var month = valDate.getMonth() + 1
                    var day = valDate.getDate()
                    var hour = valDate.getHours()
                    var minute = valDate.getMinutes()
                    var second = valDate.getSeconds()
                    var singleNumber = [year, month, day, hour, minute, second].reduce(function (beforeNum,
                        afterNum) {
                        if (afterNum) {
                            if (afterNum > 10) {
                                afterNum = String(afterNum).split('').reduce(function (beforeSonNum,
                                    afterSonNum) {
                                    beforeSonNum = Number(beforeSonNum)
                                    afterSonNum = Number(afterSonNum)
                                    return afterSonNum ? beforeSonNum + afterSonNum :
                                        beforeSonNum
                                }, 0)
                            }
                            return beforeNum + afterNum
                        } else {
                            return beforeNum
                        }
                    }, 0)
                    var total = [year, month, day, hour, minute, second].reduce(function (beforeNum, afterNum) {
                        return afterNum ? beforeNum + afterNum : beforeNum
                    })
                    console.log(total, singleNumber)
                    return total + singleNumber
                }

                function init() {
                    var params = getQueryString('c');
                    if (params) {
                        var paramsArr = params.split('+');
                        var code = paramsArr[0];
                        var timeSecretKey = paramsArr[1];
                        code = decrypt(code);
                        code = parseInt(code, 16).toString(10)
                        console.log(code, timeSecretKey, getTimeSecretKey(Number(code)),String(getTimeSecretKey(Number(code))) === timeSecretKey)
                        if (!isNaN(code) && new Date().getTime() < code && String(getTimeSecretKey(Number(code))) === timeSecretKey) {
                            return true
                        } else {
                            return false
                        }
                    } else {
                        return false
                    }
                }
                if (!init()) destroyHtml()
            })();

            function destroyHtml() {
                document.head.innerHTML = ''
                document.body.innerHTML = '暂无权限访问'
            }
            const isArray = function (e) {
                return Object.prototype.toString.call(e).toLocaleLowerCase().indexOf('array') > 0
            }
            const triggerType = {
                blur: 'blur',
                change: 'change',
                all: ['blur', 'change']
            }




            Vue.component('c-crateshot', {
                template: `
  <el-drawer class="comment-drawer" title="我是标题" :visible.sync="drawer" :with-header="false" size="600px">
      <div style="text-align:center;"
        v-loading="loading"
        element-loading-text="拼命加载中..."
        element-loading-spinner="el-icon-loading"
        element-loading-background="rgba(0, 0, 0, 0.8)"
        >
        <template v-show="!loading">
            <img class="screen-shot-img" crossorigin="anonymous" :src="createdShot" :style="{height: imgHeight}" />
            <el-button style="width:200px;margin-top:10px" type="primary" @click="downLoad">保存</el-button>
        </template>
      </div>
      <section class="phone" id="poster-target" :class="{'default-theme':shotData.themeIsDefault,'dark-theme':!shotData.themeIsDefault}">
          <main class="img-con" :style="{'background-image': 'url('+shotData.files[0]+')'}">
          </main>
          <main class="comment-popup">
              <header class="comment-header">

                  <i class="comment-popup__close el-icon-close"></i>

                  <div class="location" v-if="shotData.commentTop === 1">
                      <div class="location-icon">
                          <img class="location-img filter-invert" src="./img/location.svg" alt="">
                      </div>
                      <div class="address-info">
                          <div class="address-text">
                              {{shotData.areaCH}}
                          </div>
                          <div class="number-of-seen">
                          {{shotData.numberOfSeen}}{{shotData.numberOfSeenUnit}}人看过
                          </div>
                      </div>
                  </div>
                  <div class="search-word-con" v-else-if="shotData.commentTop === 2">
                  大家都在搜：
                    <span class="search-word">
                    {{shotData.searchWord}}
                    <svg class="search-word-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="200" height="200">
                        <path d="M921.3 874L738.1 690.8c51.3-62.6 82.1-142.5 82.1-229.6 0-200.1-162.8-363-363-363-200.1 0-363 162.8-363 363s162.8 363 363 363c87 0 167-30.8 229.6-82.1L870 925.3c7.1 7.1 16.4 10.6 25.7 10.6s18.6-3.5 25.7-10.6c14.1-14.2 14.1-37.2-.1-51.3zM166.8 461.2c0-160.1 130.3-290.4 290.4-290.4s290.4 130.3 290.4 290.4-130.3 290.4-290.4 290.4-290.4-130.3-290.4-290.4z"/>
                    </svg>
                    </span>
                  </div>
                  <div class="comment-num">
                      {{shotData.commentNum}}条评论
                  </div>

              </header>

              <content class="comment-group">
                  <div class="comment-group-con">
                      <div class="comment-item" v-for="(item, key) in shotData.commentList" :key="key">
                          <img :src="item.files[0]" class="head-img filter-invert" draggable="false" />
                          <div class="comment-item-rig">
                              <div class="nickname">
                                  <span class="name">{{item.name|overflowhidden(6)}}</span>
                                  <template v-if="item.isAuthor">
                                    <span class="author">作者</span>
                                  </template>
                              </div>
                              <div class="comment-content">
                              {{item.content}}
                              </div>
                              <div class="comment-function">
                                  <div class="comment-f-lef">
                                      <span class="time-loc">{{item.time}}·{{item.areaCH}}</span>
                                      <span class="reply">回复</span>
                                  </div>
                                  <div class="comment-f-rig">
                                      <span class="f-rig-item">
                                          <img v-if="item.isLikes" class="f-rig-icon filter-invert" src="./img/dings.svg" />
                                          <img v-else class="f-rig-icon" src="./img/ding.svg" />
                                          <span class="f-rig-t" :class="{'dings': item.isLikes}">
                                            {{(Number(item.likesNum)||'')|transformUnit}}
                                          </span>
                                      </span>
                                      <span class="f-rig-item">
                                          <img class="f-rig-icon" src="./img/cai.svg" />
                                          <span class="f-rig-t">{{(Number(item.noLikesNum)||'')|transformUnit}}</span>
                                      </span>
                                  </div>
                              </div>

                              <div class="comment-item-child">
                                <div class="comment-item" v-for="(iitem, key) in item.child" :key="key">
                                    <img :src="iitem.files[0]" class="head-img filter-invert" draggable="false" />
                                    <div class="comment-item-rig">
                                        <div class="nickname">
                                            <span class="name">{{iitem.name|overflowhidden(6)}}</span>
                                            <template v-if="iitem.isAuthor">
                                              <span class="author">作者</span>
                                            </template>
                                            <template v-if="iitem.replyNickname && !iitem.isAuthor">
                                              <i class="el-icon-caret-right"></i>
                                              <span class="name">{{iitem.replyNickname|overflowhidden(6)}}</span>
                                            </template>
                                        </div>
                                        <div class="comment-content">
                                          {{iitem.content}}
                                        </div>
                                        <div class="comment-function">
                                            <div class="comment-f-lef">
                                                <span class="time-loc">{{iitem.time}}·{{iitem.areaCH}}</span>
                                                <span class="reply">回复</span>
                                            </div>
                                            <div class="comment-f-rig">
                                                <span class="f-rig-item">
                                                    <img v-if="iitem.isLikes" class="f-rig-icon filter-invert" src="./img/dings.svg" />
                                                    <img v-else class="f-rig-icon" src="./img/ding.svg" />
                                                    <span class="f-rig-t" :class="{'dings': iitem.isLikes}">
                                                        {{(Number(iitem.likesNum)||'')|transformUnit}}
                                                    </span>
                                                </span>
                                                <span class="f-rig-item">
                                                    <img class="f-rig-icon" src="./img/cai.svg" />
                                                    <span class="f-rig-t">{{(Number(iitem.noLikesNum)||'')|transformUnit}}</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                              </div>

                          </div>
                      </div>
                  </div>
              </content>

              <footer class="comment-input-con">
                  <div class="comment-input">
                      <input class="text-input" type="text" placeholder="善于结善缘，恶言伤人心" />
                      <div class="icon-group">

                        <svg class="comment-input-icon" width="36" height="36" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.559 10.14c-2.612 2.392-3.566 5.145-3.566 8.376C6.993 21.817 8.836 29 19.215 29c1.505 0 2.974-.21 4.405-.654 1.57-.487 2.783-1.277 3.798-2.173l.15-.133c.29-.258.606-.537.86-.898.426-.523.71-.905.741-1.198.032-.293.008-.551-.189-.74-.197-.19-.517-.267-.876-.123-.322.129-.663.434-1.02.753l-.125.11c-2.434 2.134-5.158 3.007-7.744 3.007-8.219 0-10.095-5.489-10.095-8.435 0-2.947.856-4.956 2.606-6.798 1.75-1.843 4.62-2.723 7.25-2.723 5.681 0 7.745 4.598 7.745 6.964 0 3.145-1.802 4.54-2.591 5.076-.592.402-1.213.517-1.549.517h-.01c-.365 0-.89 0-1.03-.517-.09-.34.08-1.06.263-1.828.097-.405.197-.824.262-1.207l.94-4.722c.014-.092.021-.177.021-.254 0-.72-.146-1.1-1.103-1.1-.46 0-.77.074-.931.222-.161.148-.274.44-.34.878-.365-.487-.734-.815-1.107-.984-.343-.155-.833-.233-1.468-.233-1.636 0-3.053.783-4.252 2.349-1.103 1.439-1.654 2.977-1.654 4.613 0 1.277.358 2.398 1.074 3.365.796 1.065 1.833 1.597 3.112 1.597 1.095 0 2.147-.366 3.155-1.1.453.74 1.23 1.177 2.323 1.111 5.654-.339 6.962-5.275 6.896-7.783C28.647 12.75 26.288 7 18.976 7c-3.382 0-5.806.747-8.417 3.14zm3.702 9.173c-.068-1.127.093-1.976.814-3.235 1.171-2.046 2.576-2.537 3.502-2.428.898.107 1.128.5 1.27.743l.014.023c.142.24.367.648.367 1.225 0 .938-.292 1.839-.922 3.398-.732 1.84-1.483 2.19-2.4 2.4-1.512.348-2.576-.999-2.645-2.126z" fill="#2F3035" fill-opacity="0.9"></path></svg>

                        <svg class="comment-input-icon" width="36" height="36" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36"><path fill-rule="evenodd" clip-rule="evenodd" d="M27 18a9 9 0 11-18 0 9 9 0 0118 0zm-9 11c6.075 0 11-4.925 11-11S24.075 7 18 7 7 11.925 7 18s4.925 11 11 11zm-2-13.5c0 1.105-.672 2-1.5 2s-1.5-.895-1.5-2 .672-2 1.5-2 1.5.895 1.5 2zm5.5 2c.828 0 1.5-.895 1.5-2s-.672-2-1.5-2-1.5.895-1.5 2 .672 2 1.5 2zM18 22.03c-1.657 0-3-.96-3-2.143 0-1.183 6-1.183 6 0 0 1.184-1.343 2.143-3 2.143z" fill="#2F3035" fill-opacity="0.9"></path></svg>

                        <svg class="comment-input-icon"  viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="36" height="36"><path d="M512 74.667C270.933 74.667 74.667 270.933 74.667 512S270.933 949.333 512 949.333 949.333 753.067 949.333 512 753.067 74.667 512 74.667zm0 810.666C307.2 885.333 138.667 716.8 138.667 512S307.2 138.667 512 138.667 885.333 307.2 885.333 512 716.8 885.333 512 885.333z" fill="#2F3035"/><path d="M682.667 480H544V341.333c0-17.066-14.933-32-32-32s-32 14.934-32 32V480H341.333c-17.066 0-32 14.933-32 32s14.934 32 32 32H480v138.667c0 17.066 14.933 32 32 32s32-14.934 32-32V544h138.667c17.066 0 32-14.933 32-32s-14.934-32-32-32z" fill="#2F3035"/></svg>
                      </div>
                  </div>
              </footer>
          </main>
      </section>
  </el-drawer>
    `,
                data() {
                    return {
                        drawer: false,
                        createdShot: '',
                        imgHeight: '',
                        loading: false,
                        shotData: {
                            files: [],
                            commentTop: 1, // 1 显示位置+看过人次 2 显示大家都在搜
                            areaCH: '',
                            numberOfSeen: '',
                            numberOfSeenUnit: '',
                            commentNum: '', // 评论数
                            releaseTime: '', // 发布时间
                            commentList: [{
                                themeIsDefault: true,
                                searchWord: '',
                                files: [],
                                areaCH: '',
                                name: '',
                                time: '',
                                content: '',
                                LikesNum: '',
                                isAuthor: false,
                                isLikes: false,
                                child: [{
                                    files: [],
                                    areaCH: '',
                                    name: '',
                                    time: '',
                                    content: '',
                                    LikesNum: '',
                                    isAuthor: false,
                                    isLikes: false
                                }]
                            }],
                        }
                    }
                },
                created() {},
                mounted() {
                    this.$nextTick(() => {
                        this.imgHeight = (window.innerHeight - 100) + 'px'
                    })
                },
                filters: {
                    transformUnit(number) {
                        if (!number && number != 0) return number;
                        let str_num;
                        if (number >= 1E4 && number < 1E8) {
                            str_num = Math.floor(number / 1E4 * 100) / 100
                            return str_num + '万'
                        }
                        if (number >= 1E8 && number < 1E10) {
                            str_num = Math.floor(number / 1E8 * 100) / 100
                            return str_num + '亿'
                        } else if (number >= 1E10 && number < 1E11) {
                            str_num = Math.floor(number / 1E10 * 100) / 100
                            return str_num + '百亿'
                        } else if (number >= 1E11 && number < 1E12) {
                            str_num = Math.floor(number / 1E11 * 100) / 100
                            return str_num + '千亿'
                        } else if (number >= 1E12) {
                            str_num = Math.floor(number / 1E12 * 100) / 100
                            return str_num + '万亿'
                        } else { //一千以下
                            return number
                        }
                    },
                    overflowhidden(text, len) {
                        text = String(text)
                        if (text.length > len) {
                            return text.slice(0, len) + '…'
                        } else {
                            return text;
                        }
                    }
                },
                methods: {
                    downLoad() {
                        let Url = this.createdShot;
                        var blob = new Blob([''], {
                            type: 'application/octet-stream'
                        });
                        var url = URL.createObjectURL(blob);
                        var a = document.createElement('a');
                        a.href = Url;
                        a.download = '截图' || Url.replace(/(.*\/)*([^.]+.*)/ig, "$2").split("?")[0];
                        var e = document.createEvent('MouseEvents');
                        e.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false,
                            false, 0,
                            null);
                        a.dispatchEvent(e);
                        URL.revokeObjectURL(url);
                    },
                    generateShot(data) {
                        this.loading = true;
                        this.shotData = data;
                        this.drawer = true;
                        setTimeout(() => {
                            var posterTargetWidth = document.getElementById('poster-target').offsetWidth;
                            var posterTargetHeight = document.getElementById('poster-target').offsetHeight;
                            var canvas = document.createElement("canvas")
                            canvas.setAttribute('id', 'thecanvas');
                            canvas.width = posterTargetWidth * 3;
                            canvas.height = posterTargetHeight * 3;
                            canvas.style.width = posterTargetWidth + "px";
                            canvas.style.height = posterTargetHeight + "px";
                            var context = canvas.getContext("2d");
                            var html2canvasParam = {
                                width: posterTargetWidth,
                                height: posterTargetHeight,
                                scale: 3,
                                canvas: canvas
                            }
                            html2canvas(document.getElementById('poster-target'), html2canvasParam)
                                .then((
                                    canvas) => {
                                    this.createdShot = canvas.toDataURL('image/png', 1);
                                    canvas = null;
                                }).finally(() => {
                                    this.loading = false;
                                });
                        }, 200)
                    }
                }
            })
            Vue.component('c-upload', {
                template: ` 
    <el-upload :class="{'upload-disabled': uploadList.length === 1}" ref="upload" v-bind="$attrs" v-on="$listeners" :multiple="false" v-model="uploadList" :http-request="httpRequest"
        :limit="1" :before-remove="handleRemove">
        <template v-if="listType === 'picture'">
            <el-button size="small" type="primary" v-if="uploadList.length === 0">点击上传</el-button>
        </template>
        <template v-else>
            <i class="el-icon-plus"></i>
        </template>
        <div slot="tip" class="el-upload__tip">只能上传jpg/png文件</div>
    </el-upload>
`,
                model: {
                    prop: 'value',
                    event: 'change'
                },
                props: {
                    ...this.$attrs
                },
                watch: {
                    // 设置默认数据
                    value: {
                        // 首次加载的时候执行函数
                        immediate: true,
                        handler(val) {
                            this.uploadList = this.value || []
                        }
                    }
                },
                data() {
                    return {
                        uploadList: [],
                        listType: ''
                    }
                },
                mounted() {
                    this.$nextTick(function () {
                        this.listType = this.$refs.upload._props.listType;
                    })
                },
                methods: {
                    getBase64(file) {
                        return new Promise((resolve, reject) => {
                            let reader = new FileReader();
                            let imgResult = "";
                            reader.readAsDataURL(file);
                            reader.onload = function () {
                                imgResult = reader.result;
                            };
                            reader.onerror = function (error) {
                                reject(error);
                            };
                            reader.onloadend = function () {
                                resolve(imgResult);
                            };
                        });
                    },
                    async httpRequest(e) {
                        this.uploadList.push(await this.getBase64(e.file))
                        this.$emit('change', this.uploadList)
                    },
                    handleRemove(file, fileList) {
                        this.uploadList = []
                        this.$refs.upload.clearFiles();
                        this.$emit('change', [])
                    }
                }
            })
            new Vue({
                el: '#app',
                data() {
                    return {
                        colBindAttribute: {
                            sl: 8,
                            lg: 8,
                            md: 24
                        },
                        col2BindAttribute: {
                            sl: 16,
                            lg: 16,
                            md: 18,
                            sm: 22,
                            xs: 22
                        },
                        fileAccept: '.jpg,.png,jpeg', // 文件上传格式
                        formData: {
                            themeIsDefault: true,
                            commentTop: 1, // 1 显示位置+看过人次 2 显示大家都在搜
                            searchWord: '',
                            files: [],
                            areaCH: '',
                            numberOfSeen: '',
                            numberOfSeenUnit: '', // 看过人次的单位
                            commentNum: '', // 评论数
                            releaseTime: '', // 发布时间
                            commentList: [{
                                files: [],
                                areaCH: '',
                                name: '',
                                time: '',
                                content: '',
                                likesNum: '0',
                                noLikesNum: '0',
                                isAuthor: false,
                                isLikes: false,
                                child: []
                            }],
                        },
                    }
                },
                mounted() {
                    this.$nextTick(() => {
                        var code = getQueryString('c');
                        code = decrypt(code);
                        code = parseInt(code, 16).toString(10)
                        setInterval(() => {
                            if (code) {
                                if (!(!isNaN(code) && new Date().getTime() < code)) {
                                    destroyHtml()
                                }
                            }
                        }, 1000)

                        document.getElementById('app') && document.getElementById('app').setAttribute(
                            'class', '')
                    })
                },
                computed: {
                    requiredRule() {
                        return function (label) {
                            return [{
                                required: true,
                                message: label,
                                trigger: triggerType.all
                            }]
                        }
                    }
                },
                methods: {
                    uploadClearVali(e) {
                        const domRef = this.$refs[e];
                        if (isArray(domRef)) {
                            this.$refs[e][0].clearValidate()
                        } else {
                            this.$refs[e].clearValidate()
                        }
                    },
                    delComment(params = {
                        key: undefined,
                        kkey: undefined,
                    }) {
                        if (isNaN(params.key)) return;
                        if (isNaN(params.kkey)) {
                            this.formData.commentList.splice(params.key, 1)
                        } else {
                            this.formData.commentList[params.key].child.splice(params.kkey, 1)
                        }
                    },
                    createComment(params = {
                        key: undefined
                    }) {
                        let item = {
                            files: [],
                            areaCH: '',
                            name: '',
                            time: '',
                            content: '',
                            likesNum: '0',
                            noLikesNum: '0',
                            isAuthor: false,
                            isLikes: false
                        }
                        if (!isNaN(params.key)) {
                            item['replyNickname'] = ''
                            this.formData.commentList[params.key].child.push(item)
                        } else {
                            item['child'] = []
                            this.formData.commentList.push(item)
                        }
                    },
                    onSubmit() {
                        this.$refs['form'].validate((valid, val) => {
                            if (valid) {
                                this.$refs['c-crateshot'].generateShot(this.formData)
                            } else {
                                const listKeys = Object.keys(val)
                                const firstDOM = document.querySelector('label[for="' + listKeys[0] +
                                    '"]')
                                window.scrollTo(0, firstDOM.offsetTop)
                            }
                        });
                    }
                }
            })
        })()
    </script>
</body>

</html>